<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Base | Space rover control Voltbro</title>
     
    <link href="./static/css/bootstrap.min.css" rel="stylesheet">
    <link href="./static/font-awesome/css/font-awesome.css" rel="stylesheet">
    <link href="./static/css/animate.css" rel="stylesheet">
    <link href="./static/css/style.css" rel="stylesheet">

</head>

<body class="top-navigation">

    <div id="wrapper">
        <div id="page-wrapper" class="gray-bg">
        <div class="row border-bottom white-bg">
        <nav class="navbar navbar-expand-lg navbar-static-top" role="navigation">

                <a href="#" class="navbar-brand">Панель управления планетоходом</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-label="Toggle navigation">
                    <i class="fa fa-reorder"></i>
                </button>

            <div class="navbar-collapse collapse" id="navbar">
                <ul class="nav navbar-nav mr-auto">
                 
                    <li class="dropdown">
                        <a aria-expanded="false" role="button" href="#" class="dropdown-toggle" data-toggle="dropdown">Сервисы</a>
                        <ul role="menu" class="dropdown-menu">
                            <li><a href="/">Управление движением</a></li>
                            <li><a href="./payload">Управление полезной нагрузкой</a></li>
                        </ul>
                    </li>


                </ul>
               
            </div>
        </nav>
        </div>
        <div class="wrapper wrapper-content">
            <div class="container">
            <div class="row">
                <div class="col-md-3">
                    <div class="ibox ">
                        <div class="ibox-title">
                            
                            <h5>Напряжение</h5>
                        </div>
                        <div class="ibox-content">
                            <h1 class="no-margins"><span id="bat_voltage">#</span> В</h1>
                            <div class="stat-percent font-bold text-success">98% <i class="fa fa-bolt"></i></div>
                            <small>Заряд</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="ibox ">
                        <div class="ibox-title">
                            <div class="ibox-tools">
                                <span class="label label-success float-right">Данные приводов</span>
                            </div>
                            <h5>Одометрия</h5>
                        </div>
                        <div class="ibox-content">

                            <div class="row">
                                <div class="col-md-6">
                                    <h1 class="no-margins"><span id="odom_x">#</span></h1>
                                    <div class="font-bold text-success"><i class="fa fa-arrows"></i> <small>X</small></div>
                                </div>
                                <div class="col-md-6">
                                    <h1 class="no-margins"><span id="odom_y">#</span></h1>
                                    <div class="font-bold text-success"><i class="fa fa-arrows"></i> <small>Y</small></div>
                                </div>
                            </div>


                        </div>
                    </div>
                </div>
                <div class="col-md-5">
                    <div class="ibox ">
                        <div class="ibox-title">
                            <div class="ibox-tools">
                                <span class="label label-success float-right">Инерциальные данные</span>
                            </div>
                            <h5>Ориентация</h5>
                        </div>
                        <div class="ibox-content">

                            <div class="row">
                                <div class="col-md-4">
                                    <h1 class="no-margins"><span id="imu_yaw"></span></h1>
                                    <div class="font-bold text-success"><i class="fa fa-compass"></i> <small>Скольжение</small></div>
                                </div>
                                <div class="col-md-4">
                                    <h1 class="no-margins"><span id="imu_roll"></span></h1>
                                    <div class="font-bold text-success"><i class="fa fa-compass"></i> <small>Крен</small></div>
                                </div>
                                <div class="col-md-4">
                                    <h1 class="no-margins"><span id="imu_pitch"></span></h1>
                                    <div class="font-bold text-success"><i class="fa fa-compass"></i> <small>Тангаж</small></div>
                                </div>
                            </div>


                        </div>
                    </div>
                </div>

                
                
            </div>
                <div class="row">
                    <div class="col-lg-8">
                        <div class="ibox ">
                            <div class="ibox-content">
                                <div>
                                        <span class="float-right text-right">
                                        <small>Средняя частота обновления <strong> 5 fps</strong></small>
                                            <br/>
                                            Версия: 04.v21
                                        </span>
                                    <h3 class="font-bold no-margins">
                                        Маршевая камера
                                    </h3>
                                    <small>Трансляция включена</small>
                                </div>

                                <div class="m-t-sm">

                                    <div class="row">
                                        <div class="col-md-12">
                                            <div>
                                            <img src="http://{{ ros_host }}:9999/?action=stream" width="100%"/>
                                            </div>
                                        </div>
                                    </div>

                                </div>

                                <div class="m-t-md">
                                    <small class="float-right">
                                        <i class="fa fa-clock-o"> </i>
                                        Update on 0.00345 
                                    </small>
                                    <small>
                                        <strong>Внимание!:</strong> Изображения приходят с задержками. Дождись подтверждения.
                                    </small>
                                </div>

                            </div>
                        </div>
                    </div>
                   
                    <div class="col-lg-4">
                        <div class="ibox ">
                            <div class="ibox-title">
                                <div class="ibox-tools">
                                    <span class="label label-primary float-right">Connected</span>
                                </div>
                                <h5>Связь</h5>
                            </div>
                            <div class="ibox-content">
                            <div class="spiner-example" style="padding: 0px; height: 40px;">
                                <div class="sk-spinner sk-spinner-wave" >
                                    <div class="sk-rect1"></div>
                                    <div class="sk-rect2"></div>
                                    <div class="sk-rect3"></div>
                                    <div class="sk-rect4"></div>
                                    <div class="sk-rect5"></div>
                                </div>
                            </div>
                        </div>
                        </div>
                        
                            <div class="ibox ">
                                <div class="ibox-title">
                                    <div class="ibox-tools">
                                        <span class="label label-success float-right">Данные приводов</span>
                                    </div>
                                    <h5>Текущая скорость</h5>
                                </div>
                                <div class="ibox-content">
        
                                    <div class="row">
                                        <div class="col-md-6">
                                            <h1 class="no-margins"><span id="odom_lin_speed"></span></h1>
                                            <div class="font-bold text-success"><i class="fa fa-arrows"></i> <small>Линейная</small></div>
                                        </div>
                                        <div class="col-md-6">
                                            <h1 class="no-margins"><span id="odom_ang_speed"></span></h1>
                                            <div class="font-bold text-success"><i class="fa fa-arrows"></i> <small>Угловая</small></div>
                                        </div>
                                    </div>      
                                </div>
                            </div>
                        

                        <div class="ibox ">
                            <div class="ibox-title">
                                <div class="ibox-tools">
                                    <span class="label label-primary float-right">макс 0.3 м/сек</span>
                                </div>
                                <h5>Скорость движения</h5>
                            </div>
                            <div class="ibox-content">
    
                                <div class="m-r-md inline" >
                                    
                                   <div style="margin-left:40px;" class="inline" > 
                                       <input id="speed_scale_x" type="text" value="50" class="dial m-r" data-fgColor="#ED5565" data-width="85" data-height="85" data-angleOffset=-125 data-angleArc=250 />
                                    </div>
                                    <div class="float-right" style="margin-left: 30px;  width: 80px; ">Установить процент от максимальной скорости</div>
                                </div>
                            </div>
                        </div>

                        <div class="ibox ">
                            <div class="ibox-title">
                                <div class="ibox-tools">
                                    <span class="label label-primary float-right">макс 0.8 рад/сек</span>
                                </div>
                                <h5>Скорость поворота</h5>
                            </div>
                            <div class="ibox-content">
    
                                <div class="m-r-md inline" >
                                    
                                   <div style="margin-left:40px;" class="inline" >
                                       <input id="speed_scale_z" type="text" value="50" class="dial m-r" data-fgColor="#5565ED" data-width="85" data-height="85" data-angleOffset=-125 data-angleArc=250 />
                                    </div>
                                    <div class="float-right" style="margin-left: 30px;  width: 80px; ">Установить Процент от максимальной скорости</div>
                                </div>
    
    
                            </div>
                        </div>
                    
                    </div>

                </div>

            </div>

        </div>
        <div class="footer">
            <div class="float-right">
                <a href="http://voltbro.ru">voltbro ru</a>
            </div>
            <div>
                <strong>Разработано</strong> Voltbro &copy; 2021
            </div>
        </div>

        </div>
        </div>



    <!-- Mainly scripts -->
    <script src="./static/js/jquery-3.1.1.min.js"></script>
    <script src="./static/js/popper.min.js"></script>
    <script src="./static/js/bootstrap.js"></script>
    
    <script src="./static/js/plugins/metisMenu/jquery.metisMenu.js"></script>
    <script src="./static/js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

    <!-- Custom and plugin javascript -->
    <script src="./static/js/inspinia.js"></script>
    <script src="./static/js/plugins/pace/pace.min.js"></script>
    

    <!-- JSKnob -->
    <script src="./static/js/plugins/jsKnob/jquery.knob.js"></script>

     <script>

    </script>
    <script src="./static/js/eventemitter2.min.js"></script>
    <script src="./static/js/roslib.min.js"></script>
    <script src="./static/js/keyboardteleop.js"></script>

<script>
    $(document).ready(function(){
    
        // Connecting to ROS.
        var ros = new ROSLIB.Ros({
            url : 'ws://{{ ros_host }}:9090'
        });
    
        // Initialize the teleop.
        var teleop = new KEYBOARDTELEOP.Teleop({
            ros : ros,
            topic : '/cmd_vel',
        });

        $("#speed_scale_x").knob({
            'release' : function (v) { 
                teleop.scale_x = v / 100.0
             }
        }); 

        $("#speed_scale_z").knob({
            'release' : function (v) { 
                teleop.scale_z = v / 100.0
             }
        });         

    
        var tele_listener = new ROSLIB.Topic({
          ros : ros,
          name : '/web_tele',
          messageType : 'turtlebro_web/WebTelemetry'
        });
    
        tele_listener.subscribe(function(message) {
          // console.log('Received message on ' + tele_listener.name + ': ' + message.odom_x);
          $('#odom_x').text(message.odom_x.toFixed(2));
          $('#odom_y').text(message.odom_y.toFixed(2));
          $('#imu_yaw').text(message.imu_yaw);
          $('#imu_pitch').text(message.imu_pitch);
          $('#imu_roll').text(message.imu_roll);
          $('#odom_lin_speed').text(message.odom_lin_speed.toFixed(2));
          $('#odom_ang_speed').text(message.odom_ang_speed.toFixed(2));
          $('#bat_voltage').text(message.bat_voltage.toFixed(2));
    
      });
    
    
    });
</script>

</body>

</html>